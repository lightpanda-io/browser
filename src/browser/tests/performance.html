<!DOCTYPE html>
<script src="testing.js"></script>

<script id=performance>
  testing.expectEqual(performance, window.performance);
</script>

<script id=now_returns_number>
  const t = performance.now();
  testing.expectEqual('number', typeof t);
  testing.expectEqual(true, t >= 0);
</script>

<script id=now_increases>
  const t1 = performance.now();
  const t2 = performance.now();
  testing.expectEqual(true, t2 >= t1);
</script>

<script id=timeOrigin>
  const origin = performance.timeOrigin;
  testing.expectEqual('number', typeof origin);
  testing.expectEqual(true, origin > 0);
</script>

<script id=now_relative_to_origin>
  {
    const t = performance.now();
    const now = Date.now();
    testing.expectEqual(true, t < now);
  }
</script>

<script id=multiple_calls>
  {
    const times = [];
    for (let i = 0; i < 5; i++) {
      times.push(performance.now());
    }

    for (let i = 1; i < times.length; i++) {
      testing.expectEqual(true, times[i] >= times[i-1]);
    }
  }
</script>

<script id=mark>
  {
    let mark1 = performance.mark("start");
    testing.expectEqual(true, mark1 instanceof PerformanceMark);
    testing.expectEqual('start', mark1.name);
    testing.expectEqual('mark', mark1.entryType);
    testing.expectEqual(0, mark1.duration);
    testing.expectEqual(null, mark1.detail);

    let mark2 = performance.mark("start", {startTime: 32939393.9});
    testing.expectEqual(32939393.9, mark2.startTime);
  }
</script>

<script id=getEntries>
  {
    // Clear any existing marks first
    performance.clearMarks();

    const entries1 = performance.getEntries();
    const initialCount = entries1.length;

    performance.mark("test1");
    performance.mark("test2");
    performance.mark("test3");

    const entries2 = performance.getEntries();
    testing.expectEqual(initialCount + 3, entries2.length);
  }
</script>

<script id=getEntriesByType>
  {
    performance.clearMarks();

    performance.mark("mark1");
    performance.mark("mark2");

    const marks = performance.getEntriesByType("mark");
    testing.expectEqual(2, marks.length);
    testing.expectEqual('mark1', marks[0].name);
    testing.expectEqual('mark2', marks[1].name);
  }
</script>

<script id=getEntriesByName>
  {
    performance.clearMarks();

    performance.mark("myMark");
    performance.mark("otherMark");
    performance.mark("myMark");

    const entries = performance.getEntriesByName("myMark");
    testing.expectEqual(2, entries.length);
    testing.expectEqual('myMark', entries[0].name);
    testing.expectEqual('myMark', entries[1].name);

    const byType = performance.getEntriesByName("myMark", "mark");
    testing.expectEqual(2, byType.length);
  }
</script>

<script id=clearMarks>
  {
    performance.clearMarks();

    performance.mark("mark1");
    performance.mark("mark2");
    performance.mark("mark3");

    let marks = performance.getEntriesByType("mark");
    testing.expectEqual(3, marks.length);

    // Clear specific mark
    performance.clearMarks("mark2");
    marks = performance.getEntriesByType("mark");
    testing.expectEqual(2, marks.length);
    testing.expectEqual('mark1', marks[0].name);
    testing.expectEqual('mark3', marks[1].name);

    // Clear all marks
    performance.clearMarks();
    marks = performance.getEntriesByType("mark");
    testing.expectEqual(0, marks.length);
  }
</script>
