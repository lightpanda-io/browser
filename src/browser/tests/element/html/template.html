<!DOCTYPE html>
<script src="../../testing.js"></script>
<body>
<template id="basic">
  <div class="container">
    <h1>Hello Template</h1>
    <p>This is template content</p>
  </div>
</template>

<template id="nested">
  <div class="outer">
    <span id="inner1">First</span>
    <span id="inner2">Second</span>
  </div>
</template>

<template id="empty"></template>

<script id=content_property>
{
  const template = $('#basic');
  const content = template.content;

  testing.expectEqual('[object DocumentFragment]', content.toString());
  testing.expectEqual(true, content instanceof DocumentFragment);
}
</script>

<script id=content_has_children>
{
  const template = $('#basic');
  const content = template.content;

  const div = content.firstElementChild;
  testing.expectTrue(div !== null);
  testing.expectEqual('DIV', div.tagName);
  testing.expectEqual('container', div.className);

  const h1 = div.querySelector('h1');
  testing.expectTrue(h1 !== null);
  testing.expectEqual('Hello Template', h1.textContent);

  const p = div.querySelector('p');
  testing.expectTrue(p !== null);
  testing.expectEqual('This is template content', p.textContent);
}
</script>

<script id=template_children_not_in_dom>
{
  const template = $('#basic');

  testing.expectEqual(0, template.children.length);
  testing.expectEqual(null, template.firstElementChild);

  const h1InDoc = document.querySelector('#basic h1');
  testing.expectEqual(null, h1InDoc);
}
</script>

<script id=nested_template_content>
{
  const template = $('#nested');
  const content = template.content;

  const outer = content.firstElementChild;
  testing.expectEqual('DIV', outer.tagName);
  testing.expectEqual('outer', outer.className);

  const inner1 = content.querySelector('#inner1');
  testing.expectTrue(inner1 !== null);
  testing.expectEqual('First', inner1.textContent);

  const inner2 = content.querySelector('#inner2');
  testing.expectTrue(inner2 !== null);
  testing.expectEqual('Second', inner2.textContent);
}
</script>

<script id=empty_template>
{
  const template = $('#empty');
  const content = template.content;

  testing.expectEqual('[object DocumentFragment]', content.toString());
  testing.expectEqual(null, content.firstElementChild);
  testing.expectEqual(0, content.childElementCount);
}
</script>

<script id=query_selector_on_content>
{
  const template = $('#nested');
  const content = template.content;

  const spans = content.querySelectorAll('span');
  testing.expectEqual(2, spans.length);
  testing.expectEqual('inner1', spans[0].id);
  testing.expectEqual('inner2', spans[1].id);
}
</script>

<script id=modify_content>
{
  const template = $('#basic');
  const content = template.content;

  testing.expectEqual(1, content.childElementCount);

  const newDiv = document.createElement('div');
  newDiv.id = 'added';
  newDiv.textContent = 'Added element';
  content.append(newDiv);

  testing.expectEqual(2, content.childElementCount);
}
</script>

<script id=clone_template_content>
{
  const template = $('#basic');
  const content = template.content;

  const clone = content.cloneNode(true);
  testing.expectEqual('[object DocumentFragment]', clone.toString());

  const div = clone.firstElementChild;
  testing.expectTrue(div !== null);
  testing.expectEqual('container', div.className);

  const h1 = clone.querySelector('h1');
  testing.expectEqual('Hello Template', h1.textContent);
}
</script>

<script id=instantiate_template>
{
  const template = $('#nested');
  const content = template.content;

  const originalOuter = content.firstElementChild;
  testing.expectEqual(2, originalOuter.childElementCount);

  const clone = content.cloneNode(true);

  testing.expectEqual(1, clone.childElementCount);
  const clonedDiv = clone.firstElementChild;
  testing.expectEqual('DIV', clonedDiv.tagName);
  testing.expectEqual('outer', clonedDiv.className);
  testing.expectEqual(2, clonedDiv.childElementCount);

  document.body.appendChild(clone);

  testing.expectEqual(0, clone.childElementCount);

  const outerInDoc = document.body.querySelector('.outer');
  testing.expectTrue(outerInDoc !== null);
  testing.expectEqual(clonedDiv, outerInDoc);

  testing.expectEqual(2, outerInDoc.childElementCount);

  const inner1 = outerInDoc.firstElementChild;
  testing.expectEqual('SPAN', inner1.tagName);
  testing.expectEqual('inner1', inner1.id);
  testing.expectEqual('First', inner1.textContent);
}
</script>
