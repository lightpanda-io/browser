<!DOCTYPE html>
<script src="../../testing.js"></script>

<script id=history2>
    let state = { "new": "field", testComplete: true, testInProgress: true };
    history.replaceState(state, "");
    history.pushState(null, null, 'http://127.0.0.1:9589/html/history/history_after_nav.skip.html');

    let popstateEventFired = false;
    let popstateEventState = null;

    window.onpopstate = (event) => {
        popstateEventFired = true;
        popstateEventState = event.state;
    };

    testing.eventually(() => {
      testing.expectEqual(true, popstateEventFired);
      testing.expectEqual(state, popstateEventState);
    })

    history.back();
</script>
