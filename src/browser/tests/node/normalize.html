<script src="../testing.js"></script>
<div id=container></div>

<script id=normalize>
  const container = $('#container');

  // Test merging adjacent text nodes
  container.innerHTML = 'a' + 'b';
  container.normalize();
  testing.expectEqual('ab', container.innerHTML);
  testing.expectEqual(1, container.childNodes.length);

  // Test removing empty text nodes
  container.innerHTML = 'a' + '' + 'b';
  container.normalize();
  testing.expectEqual('ab', container.innerHTML);
  testing.expectEqual(1, container.childNodes.length);

  // Test recursive normalization
  container.innerHTML = '<div>a' + '' + 'b</div>c';
  container.normalize();
  testing.expectEqual('<div>ab</div>c', container.innerHTML);
  testing.expectEqual(2, container.childNodes.length);
  testing.expectEqual(1, container.firstChild.childNodes.length);

  container.innerHTML = 'a<p></p>b';
  container.normalize();
  testing.expectEqual('a<p></p>b', container.innerHTML);
  testing.expectEqual(3, container.childNodes.length);
</script>

<span id=token class="token" style="color:#ce9178">&quot;puppeteer &quot;</span>
                                        <h3 id=name>Leto
                                        <!-- -->
                                        <!-- -->
                                        Atreides</h3>
<script id=adjascent_test_nodes>
  const token = $('#token');
  testing.expectEqual('"puppeteer "', token.firstChild.nodeValue);

  const name = $('#name');
  testing.expectEqual([
    "Leto\n                                        ",
    " ",
    "\n                                        ",
    " ",
    "\n                                        Atreides"
  ], Array.from(name.childNodes).map((n) => n.nodeValue));
</script>
